@if (monster()) {
  <div content>
    @for (trait of monster()!.traits; track trait) {
      <div class="trait">
        <span class="name">{{ trait.name }}. </span>
        <formatted-text [text]="trait.description"></formatted-text>
      </div>
    }

    <div class="title">Actions</div>

    @if (monster()!.multiattack.attacksOr.length == 1) {
      @if (monster()!.multiattack.attacksOr[0].attacks.length == 1) {
        <div class="attack">
          <span class="name">Multiattack. </span>
          The {{ monster()?.name }} makes
          @for (attack of monster()!.multiattack.attacksOr[0].attacks; track attack) {
            {{ attack.number | text }} {{ attack.name }}
            @if (attack.number == 1) {
              attack
            } @else {
              attacks
            }
          }
        </div>
      }

      @if (monster()!.multiattack.attacksOr[0].attacks.length > 1) {
        <div class="attack">
          <span class="name">Multiattack. </span>
          The {{ monster()!.name }} makes {{ monster()!.multiattack.totalAttacks }}
          @if (monster()!.multiattack.totalAttacks == 1) {
            attack
          } @else {
            attacks
          }
          @for (attack of monster()!.multiattack.attacksOr[0].attacks; track attack; let last = $last) {
            {{ attack.number | text }} {{ attack.name }}
            @if (attack.number == 1) {
              attack
            } @else {
              attacks
            }
            @if (last) {
              .
            } @else {
              and
            }
          }
        </div>
      }
    }

    @if (monster()!.multiattack.attacksOr.length > 1) {
      <div class="attack">
        <span class="name">Multiattack. </span>
        The {{ monster()!.name }} makes
        @for (or of monster()!.multiattack.attacksOr; track or; let lastOr = $last) {
          @for (attack of or.attacks; track attack; let lastAnd = $last) {
            {{ attack.number | text }} {{ attack.name }}
            @if (attack.number == 1) {
              attack
            } @else {
              attacks
            }
            @if (lastAnd && lastOr) {
              .
            }
            @if (!lastAnd) {
              and
            }
          }
          @if (lastOr) {
            or
          } @else {
            .
          }
        }
      </div>
    }

    @if (monster()!.multiattack.special) {
      <div class="attack">
        <span class="name">Multiattack. </span>
        {{ monster()!.multiattack.special }}
      </div>
    }

    @for (attack of monster()!.attacks; track attack) {
      <div class="attack">
        <span class="name">{{ attack.name }}. </span>
        @if (attack.type != AttackType.UNKNOWN) {
          <span class="type">{{ attack.type }} Attack: </span>
          <value [value]="attack.toHit"></value> to hit,
          @if (attack.reach) {
            reach {{ attack.reach }} ft.,
          }
          @if (attack.range) {
            range {{ attack.range }}/{{ attack.rangeMax }} ft.,
          }
          @switch (attack.targets) {
            @case (1) {
              one
            }
            @default {
              {{ attack.targets }}
            }
          }
          @switch (attack.canTarget) {
            @case (true) {
              target
            }
            @default {
              creature
            }
          }
          . Hit:
          @for (damage of attack.hits; track damage; let last = $last) {
            <damage [damage]="damage"></damage>
            @if (last) {
              .
            } @else {
              plus
            }
          }
        }
        <formatted-text [text]="attack.special"></formatted-text>
      </div>
    }

    @for (action of monster()!.actions; track action) {
      <div class="action">
        <span class="name">{{ action.name }}. </span>
        <formatted-text [text]="action.description"></formatted-text>
      </div>
    }

    @if (monster()!.bonusActions.length) {
      <div class="title">Bonus Actions</div>
      @for (action of monster()!.bonusActions; track action) {
        <div class="action">
          <span class="name">{{ action.name }}. </span>
          <formatted-text [text]="action.description"></formatted-text>
        </div>
      }
    }

    @if (monster()!.reactions.length) {
      <div class="title">Reactions</div>
      @for (action of monster()!.reactions; track action) {
        <div class="action">
          <span class="name">{{ action.name }}. </span>
          <formatted-text [text]="action.description"></formatted-text>
        </div>
      }
    }

    @if (monster()!.legendaryActions.length) {
      <div class="title">Legendary Actions</div>

      {{ monster()!.legendaryDescription }}

      @for (action of monster()!.legendaryActions; track action) {
        <div class="action">
          <span class="name">{{ action.name }}. </span>
          <formatted-text [text]="action.description"></formatted-text>
        </div>
      }
    }
    @if (monster()!.itemsUsed.length || monster()!.itemsCarried.length) {
      <div class="title">Items</div>

      @if (monster()!.itemsUsed.length) {
        <div class="items">
          Used:
          @for (item of monster()!.itemsUsed; track item; let last = $last) {
            <reference [name]="item.name" type="item" [campaign]="campaign()" [entity]="item">{{
              item.name
            }}</reference>
            @if (!last) {
              ,
            }
          }
        </div>
      }
      @if (monster()!.itemsCarried.length) {
        <div class="items">
          Carried:
          @for (item of monster()!.itemsCarried; track item; let last = $last) {
            <reference [name]="item.name" type="item" [campaign]="campaign()" [entity]="item"
              >{{ item.multiple > 1 ? item.multiple + "x " : "" }}{{ item.name }}</reference
            >
            @if (!last) {
              ,
            }
          }
        </div>
      }
    }

    @if (miniatures.length > 0) {
      <div class="title">
        @if (miniatures.length > 1) {
          Miniatures
        } @else {
          Miniature
        }
      </div>
      @for (miniature of miniatures(); track miniature) {
        <div>{{ miniature.count }}x {{ miniature.miniature }} ({{ miniature.location }})</div>
      }
    }
  </div>
}
