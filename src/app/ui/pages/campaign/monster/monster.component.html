<entity
  [hue]="0"
  [references]="monster.references.toString()"
  [bases]="monster.common.bases"
  baseType="monster"
  [overview]="overview"
  [campaign]="campaign"
  [collapsed]="collapsed"
  (full)="onFull()"
  (expand)="expand.emit()"
  (collapse)="collapse.emit()"
>
  <div name class="name">{{monster.name}}</div>
  <div subtitle>
    {{monster.size}} {{monster.type.toString() | lowercase}}<span *ngIf="monster.tags.length">
      ({{monster.tags.join(', ') | lowercase}})</span
    >, {{monster.alignment.toString() | lowercase}}
  </div>

  <div class="incomplete" *ngFor="let incomplete of monster.common.incompletes">
    {{incomplete}}
  </div>

  <labeled-text label="Armor Class">
    <value [value]="monster.armorClass" [inline]="true"></value>
  </labeled-text>
  <labeled-text label="Hit Points">{{monster.hitDice.average}} ({{monster.hitDice}})</labeled-text>
  <labeled-text label="Speed">{{monster.speeds.join(', ')}}</labeled-text>

  <taper></taper>

  <div class="abilities">
    <div class="ability" *ngFor="let ability of monster.abilities.abilities">
      <div class="name">{{ability.type.short}}</div>
      <div class="value">
        {{ability.value}} ({{ability.modifier}})
      </div>
    </div>
  </div>

  <taper></taper>

  <labeled-text *ngIf="monster.savingThrows.length" label="Saving Throws">
    <span *ngFor="let savingThrow of monster.savingThrows; last as last">
      {{savingThrow.ability}} {{savingThrow.value | modifier}}<ng-container *ngIf="!last">, </ng-container>
    </span>
  </labeled-text>
  <labeled-text label="Skills">
    <div
      *ngFor="let skill of monster.filterSkills(overview); last as last"
      class="skill"
      [class.skilled]="skill.skilled"
    >
      {{skill.name}} <value [value]="skill.modifier"></value>{{last ? '' : ',&nbsp;'}}
    </div>
  </labeled-text>
  <labeled-text label="Damage Immunities" *ngIf="monster.damageImmunities.length > 0">
    <span *ngFor="let immunity of monster.damageImmunities; last as last">
      {{immunity}}{{last ? '' : ', '}}
    </span>
  </labeled-text>
  <labeled-text label="Condition Immunities" *ngIf="monster.conditionImmunities.length > 0">
    <span *ngFor="let immunity of monster.conditionImmunities; last as last">
      {{immunity}}{{last ? '' : ', '}}
    </span>
  </labeled-text>
  <labeled-text label="Senses">
    <ng-container *ngIf="monster.senses.text"> {{monster.senses}}, </ng-container>passive Perception
    {{monster.passivePerception}}
  </labeled-text>
  <labeled-text label="Languages">
    <ng-container *ngIf="monster.languages.text">{{monster.languages.text}}</ng-container>
    <ng-container *ngIf="!monster.languages.text">&mdash;</ng-container>
  </labeled-text>
  <labeled-text label="Challenge">{{monster.challenge}} ({{monster.xp}} XP)</labeled-text>
  <labeled-text label="Proficienty Bonus" *ngIf="!overview">+{{monster.proficiency}}</labeled-text>

  <taper></taper>

  <div content>
    <div class="trait" *ngFor="let trait of monster.traits">
      <span class="name">{{trait.name}}. </span>
      <formatted-text [text]="trait.description"></formatted-text>
    </div>

    <div class="title">Actions</div>

    <ng-container *ngIf="monster.multiattack.attacksOr.length == 1">
      <div class="attack" *ngIf="monster.multiattack.attacksOr[0].attacks.length == 1">
        <span class="name">Multiattack. </span>
        The {{monster.name}} makes
        <ng-container *ngFor="let attack of monster.multiattack.attacksOr[0].attacks">
          {{attack.number | text}} {{attack.name}}
          <ng-container *ngIf="attack.number == 1">attack</ng-container>
          <ng-container *ngIf="attack.number != 1">attacks</ng-container>.
        </ng-container>
      </div>

      <div class="attack" *ngIf="monster.multiattack.attacksOr[0].attacks.length > 1">
        <span class="name">Multiattack. </span>
        The {{monster.name}} makes {{monster.multiattack.totalAttacks}}
        <ng-container *ngIf="monster.multiattack.totalAttacks == 1">attack</ng-container>
        <ng-container *ngIf="monster.multiattack.totalAttacks != 1">attacks</ng-container>:
        <ng-container *ngFor="let attack of monster.multiattack.attacksOr[0].attacks; last as last">
          {{attack.number | text}} {{attack.name}}
          <ng-container *ngIf="attack.number == 1">attack</ng-container>
          <ng-container *ngIf="attack.number != 1">attacks</ng-container>
          <ng-container *ngIf="!last"> and </ng-container>
          <ng-container *ngIf="last">.</ng-container>
        </ng-container>
      </div>
    </ng-container>

    <ng-container *ngIf="monster.multiattack.attacksOr.length > 1">
      <div class="attack">
        <span class="name">Multiattack. </span>
        The {{monster.name}} makes
        <ng-container *ngFor="let or of monster.multiattack.attacksOr; last as lastOr">
          <ng-container *ngFor="let attack of or.attacks; last as lastAnd">
            {{attack.number | text}} {{attack.name}}
            <ng-container *ngIf="attack.number == 1">attack</ng-container>
            <ng-container *ngIf="attack.number != 1">attacks</ng-container>
            <ng-container *ngIf="!lastAnd"> and </ng-container>
            <ng-container *ngIf="lastAnd && lastOr">.</ng-container>
          </ng-container>
          <ng-container *ngIf="!lastOr"> or </ng-container>
          <ng-container *ngIf="lastOr">.</ng-container>
        </ng-container>
      </div>
    </ng-container>

    <div class="attack" *ngFor="let attack of monster.attacks">
      <span class="name">{{attack.name}}. </span>
      <ng-container *ngIf="attack.type != AttackType.UNKNOWN">
        <span class="type">{{attack.type}} Attack: </span>
        {{(attack.toHit) | modifier}} to hit,
        <ng-container *ngIf="attack.reach">
          reach {{attack.reach}} ft.,
        </ng-container>
        <ng-container *ngIf="attack.range">
          range {{attack.range}}/{{attack.rangeMax}} ft.,
        </ng-container>
        <span [ngSwitch]="attack.targets">
          <span *ngSwitchCase="1">one</span>
          <span *ngSwitchDefault>{{attack.targets}}</span>
        </span>
        <span [ngSwitch]="attack.canTarget">
          <span *ngSwitchCase="true"> target</span>
          <span *ngSwitchCase="false"> creature</span> </span
        >. Hit:
        <span *ngFor="let damage of attack.hits; last as last">
          {{damage.withAverage}}<ng-container *ngIf="last">.</ng-container>
          <ng-container *ngIf="!last"> plus </ng-container>
        </span>
      </ng-container>
      {{attack.special}}
    </div>

    <div class="action" *ngFor="let action of monster.actions">
      <span class="name">{{action.name}}. </span>
      <formatted-text [text]="action.description"></formatted-text>
    </div>

    <ng-container *ngIf="monster.reactions.length">
      <div class="title">Reactions</div>
      <div class="action" *ngFor="let action of monster.reactions">
        <span class="name">{{action.name}}. </span>
        <formatted-text [text]="action.description"></formatted-text>
      </div>
    </ng-container>

    <ng-container *ngIf="monster.legendaryActions.length">
      <div class="title">Legendary Actions</div>

      {{monster.legendaryDescription}}

      <div class="action" *ngFor="let action of monster.legendaryActions">
        <span class="name">{{action.name}}. </span>
        <formatted-text [text]="action.description"></formatted-text>
      </div>
    </ng-container>

    <ng-container *ngIf="monster.itemsUsed.length || monster.itemsCarried.length">
      <div class="title">Items</div>

      <div class="items" *ngIf="monster.itemsUsed.length">
        Used:
        <ng-container *ngFor="let item of monster.itemsUsed; last as last">
          <reference [name]="item.name" type="item" [campaign]="campaign" [entity]="item">{{item.name}}</reference
          ><ng-container *ngIf="!last">, </ng-container>
        </ng-container>
      </div>

      <div class="items" *ngIf="monster.itemsCarried.length">
        Carried:
        <ng-container *ngFor="let item of monster.itemsCarried; last as last">
          <reference [name]="item.name" type="item" [campaign]="campaign" [entity]="item"
            >{{item.multiple > 1 ? item.multiple + 'x ' : ''}}{{item.name}}</reference
          ><ng-container *ngIf="!last">, </ng-container>
        </ng-container>
      </div>
    </ng-container>
  </div>
</entity>
